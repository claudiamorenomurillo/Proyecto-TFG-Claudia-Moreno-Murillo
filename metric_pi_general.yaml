pg_pi_cientifico_bbdd:
  query:
    WITH latest_dates AS (
        SELECT
            schema_name,
            MAX(fecha) AS max_fecha
        FROM
            cientifico_metrics
        GROUP BY
            schema_name
    )
    SELECT
        t.datname,
        t.fecha,
        t.fk,
        t.pk,
        t.trigger,
        t.varchar_all,
        t.pk_no_num_unacolumn,
        t.columnas_mas_64,
        t.pk_column_mas_3,
        t.schema_name
    FROM
        cientifico_metrics t
    JOIN
        latest_dates ld
    ON
        t.schema_name = ld.schema_name
        AND t.fecha = ld.max_fecha;

  metrics:
    - fk:
        usage: "COUNTER"
        description: "Falta indices en fk"
    - datname:
        usage: "LABEL"
        description: "Nombre de la base de datos"
    - schema_name:
        usage: "LABEL"
        description: "Nombre del esquema de la base de datos"
    - pk:
        usage: "COUNTER"
        description: "Tablas sin clave primaria"
    - trigger:
        usage: "COUNTER"
        description: "Cantidad de trigger en la base de datos"
    - varchar_all:
        usage: "COUNTER"
        description: "Tablas con todas las columnas varchar"
    - pk_no_num_unacolumn:
        usage: "COUNTER"
        description: "Tablas con pk en solo una columna y no numericas"
    - columnas_mas_64:
        usage: "COUNTER"
        description: "Tablas con mas de 64 columnas"
    - pk_column_mas_3:
        usage: "COUNTER"
        description: "Tablas con mas de 3 claves primarias"
